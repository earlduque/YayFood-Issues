# YayFood 1.2.0 Release Notes

## What's New

### Map Gallery
See all your restaurants on an interactive map:

- **Color-Coded Score Markers**: Restaurant pins show average ratings with color coding -- green (8+), orange (5-8), red (below 5), and gray for unrated
- **Tappable Pins**: Tap any restaurant marker to open its detail sheet
- **Zoom Controls**: Plus/minus buttons for quick zoom in/out with auto-hiding after 3 seconds of inactivity
- **My Location Button**: Re-center the map on your current location at city-level zoom with one tap
- **User Location Dot**: See your current position on the map with the standard blue dot
- **Auto-Center on You**: Map automatically centers on your current location when you open the Map tab
- **Configurable Default Zoom**: Choose your preferred initial zoom level (Neighborhood, City, County, or Region) in Settings > Map -- persists between sessions
- **Dedicated Tab**: Appears as a new Map tab in the main navigation
- **Discover Nearby Restaurants**: Floating button (bottom-left) enters discovery mode -- zooms to street level, searches Apple Maps for nearby restaurants, and shows them as blue "+" pins. Tap a pin to add the restaurant pre-filled with name, address, and coordinates, then immediately add a dish
- **Discovery Mode Banner**: Clear visual indicator with "Done" button to exit discovery mode
- **Empty State Discovery**: "Discover Nearby Restaurants" button appears when no restaurants have locations, giving new users a great starting point

### Enhanced Card Export Layouts
Share your food discoveries on social media with beautiful, customizable card exports:

- **Hero Score Layout**: Export single dishes with large centered ratings and 5-star visualization
- **Intelligent Restaurant Collages**: Showcase 1-16 dishes with smart grid layouts
- **Adaptive Photo Grids**: Automatically selects the best grid layout for your photo count and card size
- **Top-Rated Priority**: Highest-rated dishes get extra visual space with prominent top-row placement
- **Customizable Photo Count**: Choose exactly how many dishes to include (1-16 or "All available")
- **Big Score Overlays**: Large, easy-to-read ratings (perfect 10s display as "10" instead of "10.0")
- **Multiple Sizes**: Square (1:1), Post (4:5), and Story (9:16) formats for any platform

### Tap-to-Preview Export Cards
- **Interactive Preview**: Tap the placeholder to generate and preview cards before sharing
- **Setting Adjustments**: Change size/privacy settings and regenerate preview on the fly
- **Instant Actions**: "Save to Photos" and "Share" buttons reuse existing preview

### Simplified Analytics
Refocused analytics on what matters most -- your ratings:

- **Top Rated Section**: View your top 5 restaurants and dishes by rating
- **Rating Distribution**: Visual breakdown showing excellent/great/good/average/poor ratings
- **Family Insights**: Per-person analytics with favorite restaurants and dishes (when using family ratings)
- **Recent Activity**: Recently rated dishes with relative timestamps

Removed visit/order frequency tracking to focus on rating-based insights.

### Exclude Dishes from Restaurant Score
Control which dishes count toward a restaurant's overall rating:

- **Score Exclusion Toggle**: New "Score Options" section in Edit Dish lets you exclude any dish from the restaurant's average score -- perfect for minor side dishes that shouldn't drag down the overall rating
- **Visual Indicators**: Excluded dishes show an orange "excluded" badge in the dish list, an info banner in dish details, and the restaurant header shows "Based on X of Y dishes" when any dishes are excluded
- **Automatic Propagation**: Adjusted scores are reflected everywhere -- restaurant list, map pins, analytics, card exports, and sorting

## Improvements

### Refactored Architecture
Under the hood, the ViewModel has been simplified by extracting business logic into focused manager services for better maintainability:

- **RestaurantManager**: Restaurant CRUD operations
- **DishManager**: Dish management operations
- **PersonRaterManager**: Person and rating management
- **RatingManager**: Rating-specific operations
- **DataExportImportManager**: Import/export functionality

### Simplified Core Data Model
Cleaned up the data model to remove unused entities and attributes, resulting in a leaner 5-entity model (Restaurant, Dish, Person, Rating, Visit).

### iCloud Sync Reliability
Improved CloudKit sync configuration to prevent potential data loss:

- **Conflict Resolution**: Added proper merge policy so sync conflicts between devices are resolved reliably instead of silently failing
- **Persistent History Tracking**: Enabled required CloudKit sync options for reliable change tracking
- **Background Sync Support**: CloudKit can now sync data after the device is unlocked, even while the app is in the background
- **Delete Confirmation Dialogs**: Swipe-to-delete on restaurants, dishes, and people now shows a confirmation alert before permanently removing data
- **Background Save**: App automatically saves pending changes when entering the background

### Scroll-to-Top on Tab Re-Tap
- **Tap any tab to scroll to top**: Re-tapping the currently active tab scrolls the view back to the top -- works on Restaurants, Dishes, Gallery, and Settings tabs
- **Map tab reset**: Re-tapping the Gallery tab while in Map mode exits Discovery Mode and resets the map to the default position

## Bug Fixes

- Fixed gallery photo grid showing a blank first square with all images shifted by one position
- Fixed restaurant and dish lists not updating immediately after automatic cleanup
- Fixed incorrect dish counts showing on restaurant cards
- Fixed map zoom buttons not working due to map camera position not being tracked after user interactions

### Filter System Improvements
- **Fixed Filter Lock**: When selecting a person with no dishes, a "Clear Filter" button now appears
- **Improved Empty States**: Person-specific empty messages ("No dishes rated by [Name]")
- **Better Navigation**: Always provides a way to clear filters and return to full list

## Requirements

- **iOS**: 17.0 or later
- **Storage**: Minimal -- all photos stored locally with aggressive compression
- **Internet**: Only needed for optional Pexels image fetching -- everything else works offline
